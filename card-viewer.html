<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="pageTitle">CardGift - Greeting Card</title>
	
	<!-- Favicon fix -->
   <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÅ</text></svg>">
    
    <!-- ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï DYNAMIC OPEN GRAPH –¥–ª—è –ø—Ä–µ–≤—å—é –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö -->
    <meta property="og:title" content="üéâ Personal Greeting Card - CardGift" id="ogTitle">
    <meta property="og:description" content="Beautiful personalized card created with CardGift Web3 platform" id="ogDescription">
    <meta property="og:image" content="" id="ogImage">
    <meta property="og:image:width" content="1200" id="ogImageWidth">
    <meta property="og:image:height" content="630" id="ogImageHeight">
    <meta property="og:type" content="website">
    <meta property="og:url" content="" id="ogUrl">
    <meta property="og:site_name" content="CardGift">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üéâ Personal Greeting Card - CardGift" id="twitterTitle">
    <meta name="twitter:description" content="Beautiful personalized card created with CardGift Web3 platform" id="twitterDescription">
    <meta name="twitter:image" content="" id="twitterImage">
    
    <!-- ‚úÖ WEB3 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
	
	<script>
// ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô VideoProcessor —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
class EnhancedVideoProcessor {
    constructor() {
        this.supportedPlatforms = {
            youtube: {
                patterns: [
                    /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/
                ],
                embed: (id) => `https://www.youtube-nocookie.com/embed/${id}?enablejsapi=1&controls=1&rel=0&modestbranding=1&playsinline=1&origin=${encodeURIComponent(window.location.origin)}`
            },
            tiktok: {
                patterns: [
                    /tiktok\.com\/@[\w.-]+\/video\/(\d+)/,
                    /vm\.tiktok\.com\/([a-zA-Z0-9]+)/
                ],
                embed: (id) => `https://www.tiktok.com/embed/v2/${id}`
            },
            instagram: {
                patterns: [
                    /instagram\.com\/p\/([a-zA-Z0-9_-]+)/,
                    /instagram\.com\/reel\/([a-zA-Z0-9_-]+)/
                ],
                embed: (id) => `https://www.instagram.com/p/${id}/embed/`
            }
        };
    }

    parseVideoUrl(url) {
        if (!url || typeof url !== 'string') {
            return { isValid: false, error: 'Invalid URL' };
        }

        url = url.trim();
        
        // –î–µ–∫–æ–¥–∏—Ä—É–µ–º HTML entities
        url = url
            .replace(/&#x2F;/g, '/')
            .replace(/&amp;/g, '&')
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&quot;/g, '"')
            .replace(/&#x27;/g, "'");

        for (const [platform, config] of Object.entries(this.supportedPlatforms)) {
            for (const pattern of config.patterns) {
                const match = url.match(pattern);
                if (match) {
                    const videoId = match[1];
                    return {
                        isValid: true,
                        platform: platform,
                        videoId: videoId,
                        originalUrl: url,
                        embedUrl: config.embed(videoId)
                    };
                }
            }
        }

        return { isValid: false, error: 'Unsupported video platform' };
    }

    createEnhancedVideoElement(videoData, container) {
        if (!videoData.isValid) {
            this.showVideoError(container, videoData.error || 'Invalid video URL');
            return;
        }

        container.innerHTML = '';
        container.style.background = '#000';

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–µ–æ
        const videoContainer = document.createElement('div');
        videoContainer.className = `${videoData.platform}-container video-container`;
        videoContainer.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            background: #000;
            border-radius: inherit;
            overflow: hidden;
        `;

        // –°–æ–∑–¥–∞–µ–º iframe
        const iframe = document.createElement('iframe');
        iframe.src = videoData.embedUrl;
        iframe.frameBorder = '0';
        iframe.allowFullscreen = true;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen';
        iframe.sandbox = 'allow-scripts allow-same-origin allow-presentation allow-forms';
        iframe.loading = 'lazy';
        iframe.style.cssText = `
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: all;
            border-radius: inherit;
        `;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è iframe
        iframe.onload = () => {
            console.log(`‚úÖ ${videoData.platform} video loaded successfully`);
            this.hideVideoLoading(videoContainer);
        };

        iframe.onerror = () => {
            console.error(`‚ùå ${videoData.platform} video failed to load`);
            this.showVideoError(container, `Failed to load ${videoData.platform} video`);
        };

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        this.showVideoLoading(videoContainer, videoData.platform);

        videoContainer.appendChild(iframe);
        container.appendChild(videoContainer);

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è YouTube
        if (videoData.platform === 'youtube') {
            this.createSoundControlButton(videoContainer, iframe);
        }

        return { iframe, container: videoContainer };
    }

    createSoundControlButton(container, iframe) {
        const soundBtn = document.createElement('button');
        soundBtn.className = 'sound-control-btn';
        soundBtn.innerHTML = 'üîä Sound';
        soundBtn.style.cssText = `
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            border: 2px solid #FFD700;
            padding: 8px 12px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        `;

        soundBtn.onmouseover = () => {
            soundBtn.style.background = 'rgba(255, 215, 0, 0.2)';
            soundBtn.style.transform = 'scale(1.05)';
        };

        soundBtn.onmouseout = () => {
            soundBtn.style.background = 'rgba(0, 0, 0, 0.8)';
            soundBtn.style.transform = 'scale(1)';
        };

        soundBtn.onclick = () => this.enableSound(iframe, soundBtn);

        container.appendChild(soundBtn);
    }

    enableSound(iframe, button) {
        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ YouTube iframe
            iframe.contentWindow.postMessage('{"event":"command","func":"unMute","args":""}', '*');
            iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
            
            button.innerHTML = 'üîä ON';
            button.style.background = 'rgba(76, 175, 80, 0.8)';
            button.style.borderColor = '#4CAF50';
            
            setTimeout(() => {
                button.style.opacity = '0';
                setTimeout(() => button.remove(), 300);
            }, 2000);
            
        } catch (error) {
            console.warn('Could not control video player:', error);
            button.innerHTML = '‚ùå Error';
            button.style.background = 'rgba(244, 67, 54, 0.8)';
        }
    }

    showVideoLoading(container, platform) {
        const loading = document.createElement('div');
        loading.className = 'video-loading';
        loading.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #FFD700;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
            font-weight: bold;
        `;
        loading.innerHTML = `
            <div style="font-size: 24px; margin-bottom: 10px;">üîÑ</div>
            <div>Loading ${platform} video...</div>
        `;
        container.appendChild(loading);
    }

    showVideoError(container, message) {
        container.innerHTML = `
            <div style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 68, 68, 0.9);
                color: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                z-index: 10;
                font-weight: bold;
                max-width: 80%;
            ">
                <div style="font-size: 32px; margin-bottom: 10px;">‚ùå</div>
                <div>${message}</div>
            </div>
        `;
    }

    hideVideoLoading(container) {
        const loading = container.querySelector('.video-loading');
        if (loading) {
            loading.style.opacity = '0';
            setTimeout(() => loading.remove(), 300);
        }
    }
}

const videoProcessor = new EnhancedVideoProcessor();

// ‚úÖ –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –î–õ–Ø CARD-VIEWER
class CardNotificationSystem {
    constructor() {
        this.container = this.createContainer();
    }

    createContainer() {
        const container = document.createElement('div');
        container.id = 'cardNotificationContainer';
        container.style.cssText = `
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10001;
            pointer-events: none;
            max-width: 90vw;
        `;
        document.body.appendChild(container);
        return container;
    }

    show(message, type = 'info', duration = 3000) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            margin-bottom: 10px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #333;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            pointer-events: auto;
            cursor: pointer;
            font-size: 14px;
        `;

        // –¶–≤–µ—Ç–∞ –ø–æ —Ç–∏–ø–∞–º
        const colors = {
            success: { border: '#4CAF50', bg: 'rgba(76, 175, 80, 0.15)', color: '#4CAF50' },
            error: { border: '#f44336', bg: 'rgba(244, 67, 54, 0.15)', color: '#f44336' },
            warning: { border: '#FF9800', bg: 'rgba(255, 152, 0, 0.15)', color: '#FF9800' },
            info: { border: '#2196F3', bg: 'rgba(33, 150, 243, 0.15)', color: '#2196F3' }
        };

        if (colors[type]) {
            notification.style.borderColor = colors[type].border;
            notification.style.background = colors[type].bg;
            notification.style.color = colors[type].color;
        }

        notification.textContent = message;
        this.container.appendChild(notification);

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        setTimeout(() => {
            notification.style.opacity = '1';
            notification.style.transform = 'translateY(0)';
        }, 100);

        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
        const timeoutId = setTimeout(() => {
            this.remove(notification);
        }, duration);

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É
        notification.addEventListener('click', () => {
            clearTimeout(timeoutId);
            this.remove(notification);
        });

        return notification;
    }

    remove(notification) {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 400);
    }
}

const cardNotifications = new CardNotificationSystem();

// ‚úÖ –ú–ï–ù–ï–î–ñ–ï–† –£–†–û–í–ù–ï–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
class UserLevelManager {
    constructor() {
        this.levels = {
            0: { name: 'FREE', features: ['Basic viewing'] },
            1: { name: 'USER', features: ['Archive access', 'Basic sharing'] },
            2: { name: 'MINI', features: ['Advanced sharing', 'Templates'] },
            3: { name: 'ADMIN', features: ['All features', 'Priority support'] },
            4: { name: 'SUPER', features: ['Unlimited sharing', 'Custom branding'] },
            5: { name: 'MANAGER', features: ['Team features', 'Analytics'] },
            6: { name: 'AUTHOR', features: ['Unlimited everything', 'Co-author access'] }
        };
    }

    getLevelInfo(level) {
        return this.levels[level] || this.levels[0];
    }

    getUserLevel(userId) {
        try {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                const user = JSON.parse(userData);
                return user.level || 0;
            }
        } catch (error) {
            console.warn('Error getting user level:', error);
        }
        return 0;
    }
}

const levelManager = new UserLevelManager();
</script>
    
    <style>
        /* ‚úÖ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }

        /* ‚úÖ –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundShift 10s ease infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –Ø–ó–´–ö–û–í–û–ô –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ */
        .language-switcher {
            position: fixed;
            top: 8px;
            right: 8px;
            z-index: 1000;
            display: flex;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 3px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .lang-btn {
            background: transparent;
            border: none;
            color: #FFD700;
            padding: 6px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 28px;
        }

        .lang-btn.active {
            background: rgba(255, 215, 0, 0.3);
            color: #FFF;
            transform: scale(1.05);
        }

        .lang-btn:hover:not(.active) {
            background: rgba(255, 215, 0, 0.1);
            transform: scale(1.02);
        }
        
        /* ‚úÖ –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† - –£–õ–£–ß–®–ï–ù–ù–´–ô –ú–û–ë–ò–õ–¨–ù–´–ô –î–ò–ó–ê–ô–ù */
        .mobile-container {
            max-width: 400px;
            width: 90vw;
            height: 80vh;
            min-height: 600px;
            margin: 5vh auto;
            background: #000;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 
                0 30px 80px rgba(0,0,0,0.4),
                0 0 0 1px rgba(255,255,255,0.1),
                0 0 50px rgba(255, 215, 0, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –°–¢–ê–¢–£–° –ë–ê–† */
        .status-bar {
            height: 28px;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 18px;
            font-size: 12px;
            color: #FFF;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .status-left {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-right {
            display: flex;
            align-items: center;
            gap: 4px;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ë–ï–ì–£–©–ê–Ø –°–¢–†–û–ö–ê */
        .top-marquee {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            height: 36px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            font-weight: bold;
            font-size: 12px;
            position: relative;
        }
        
        .top-marquee.show {
            display: flex;
            animation: slideDown 0.5s ease forwards;
        }
        
        .top-marquee:hover {
            background: linear-gradient(45deg, #FFE55C, #FFB700);
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .marquee-content {
            animation: marqueeMove 20s linear infinite;
            white-space: nowrap;
            padding-left: 100%;
            font-weight: 700;
        }
        
        @keyframes marqueeMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        @keyframes slideDown {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        /* ‚úÖ –û–°–ù–û–í–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ –ö–ê–†–¢–´ –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò */
        .card-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–û–ï –§–û–ù–û–í–û–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï */
        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
            transition: all 0.5s ease;
        }
		
		/* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –í–ò–î–ï–û –ö–û–ù–¢–ï–ô–ù–ï–†–û–í */
        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            background: #000;
            border-radius: inherit;
            overflow: hidden;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: all;
            border-radius: inherit;
        }

        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê –ó–í–£–ö–ê */
        .sound-control-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            color: #FFD700;
            border: 2px solid #FFD700;
            padding: 10px 15px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .sound-control-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 215, 0, 0.3);
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –ö–û–ù–¢–ï–ù–¢ –ü–û–í–ï–†–• */
        .card-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px 25px 80px 25px;
            text-align: center;
            pointer-events: none;
        }

        .card-content > * {
            pointer-events: auto;
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê */
        .card-title {
            color: #FFFFFF;
            font-size: 26px;
            font-weight: 800;
            text-shadow: 
                -3px -3px 0 #000,
                3px -3px 0 #000,
                -3px 3px 0 #000,
                3px 3px 0 #000,
                -2px 0 0 #000,
                2px 0 0 #000,
                0 -2px 0 #000,
                0 2px 0 #000,
                0 0 20px rgba(0,0,0,1),
                0 0 35px rgba(0,0,0,0.8);
            margin-bottom: 18px;
            opacity: 0;
            animation: fadeInUp 1s ease 0.5s forwards;
            position: relative;
            z-index: 11;
            line-height: 1.2;
        }
        
        .card-subtitle {
            color: #FFD700;
            font-size: 18px;
            font-weight: 700;
            text-shadow: 
                -3px -3px 0 #000,
                3px -3px 0 #000,
                -3px 3px 0 #000,
                3px 3px 0 #000,
                -2px 0 0 #000,
                2px 0 0 #000,
                0 -2px 0 #000,
                0 2px 0 #000,
                0 0 20px rgba(0,0,0,1),
                0 0 35px rgba(0,0,0,0.8);
            margin-bottom: 25px;
            opacity: 0;
            animation: fadeInUp 1s ease 0.8s forwards;
            position: relative;
            z-index: 11;
            line-height: 1.3;
        }
        
        .greeting-text {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 600;
            text-shadow: 
                -3px -3px 0 #000,
                3px -3px 0 #000,
                -3px 3px 0 #000,
                3px 3px 0 #000,
                -2px 0 0 #000,
                2px 0 0 #000,
                0 -2px 0 #000,
                0 2px 0 #000,
                0 0 20px rgba(0,0,0,1),
                0 0 35px rgba(0,0,0,0.8);
            line-height: 1.5;
            opacity: 0;
            animation: fadeInUp 1s ease 1.1s forwards;
            max-width: 320px;
            position: relative;
            z-index: 11;
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ù–ò–ñ–ù–Ø–Ø –û–ë–õ–ê–°–¢–¨ */
        .bottom-area {
            background: linear-gradient(
                180deg,
                rgba(0,0,0,0.8) 0%,
                rgba(0,0,0,0.95) 100%
            );
            padding: 20px;
            z-index: 3;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø CTA –°–ï–ö–¶–ò–Ø */
        .cta-section {
            text-align: center;
            margin-bottom: 18px;
            display: none;
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .cta-section.show {
            display: block;
        }
        
        .cta-text {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .cta-subtitle {
            color: #FFD700;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            opacity: 0.9;
        }
        
        /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê –î–ï–ô–°–¢–í–ò–Ø */
        .action-button {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 12px;
            display: none;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .action-button:hover::before {
            left: 100%;
        }
        
        .action-button.show {
            display: block;
            animation: bounceIn 0.6s ease forwards;
        }
        
        .action-button:hover {
           background: linear-gradient(45deg, #FFE55C, #FFB700);
           transform: translateY(-2px) scale(1.02);
           box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
       }

       .action-button:active {
           transform: translateY(0) scale(0.98);
       }
       
       /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –ù–ò–ñ–ù–ò–ô –ë–ê–ù–ù–ï–† */
       .bottom-banner {
           background: linear-gradient(45deg, #FFD700, #FFA500);
           color: #000;
           padding: 12px;
           text-align: center;
           font-weight: bold;
           font-size: 13px;
           cursor: pointer;
           transition: all 0.3s ease;
           opacity: 0;
           transform: translateY(100%);
           display: none;
           box-shadow: 0 -4px 20px rgba(255, 215, 0, 0.2);
           position: relative;
           overflow: hidden;
       }

       .bottom-banner::before {
           content: '';
           position: absolute;
           top: 0;
           left: -100%;
           width: 100%;
           height: 100%;
           background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
           transition: left 0.7s ease;
       }

       .bottom-banner:hover::before {
           left: 100%;
       }
       
       .bottom-banner.show {
           display: block;
           opacity: 1;
           transform: translateY(0);
           animation: slideUpBanner 0.6s ease forwards;
       }

       .bottom-banner:hover {
           background: linear-gradient(45deg, #FFE55C, #FFB700);
           transform: translateY(-1px);
           box-shadow: 0 -6px 25px rgba(255, 215, 0, 0.3);
       }
       
       /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –§–û–ù–û–í */
       .style-classic {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
       }
       
       .style-sunset {
           background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ffd89b 100%);
       }
       
       .style-ocean {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
       }
       
       .style-space {
           background: linear-gradient(135deg, #0c0c0c 0%, #000000 100%);
           position: relative;
       }
       
       .style-space::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-image: 
               radial-gradient(2px 2px at 20px 30px, #FFD700, transparent),
               radial-gradient(2px 2px at 40px 70px, rgba(255, 215, 0, 0.8), transparent),
               radial-gradient(1px 1px at 90px 40px, #FFD700, transparent),
               radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.6), transparent),
               radial-gradient(2px 2px at 160px 30px, #FFD700, transparent);
           background-repeat: repeat;
           background-size: 250px 150px;
           animation: sparkle 4s ease-in-out infinite;
           z-index: 1;
       }
       
       /* ‚úÖ –ù–û–í–´–ô NEON –°–¢–ò–õ–¨ –° –ê–ù–ò–ú–ê–¶–ò–ï–ô */
       .style-neon {
           background: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF);
           background-size: 400% 400%;
           animation: neonGradient 4s ease infinite;
           position: relative;
       }

       .style-neon::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: 
               radial-gradient(circle at 25% 25%, rgba(255, 0, 110, 0.3) 0%, transparent 50%),
               radial-gradient(circle at 75% 75%, rgba(131, 56, 236, 0.3) 0%, transparent 50%),
               radial-gradient(circle at 50% 50%, rgba(58, 134, 255, 0.2) 0%, transparent 50%);
           animation: neonPulse 3s ease-in-out infinite;
           z-index: 1;
       }

       .style-neon::after {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: 
               linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
           animation: neonSweep 6s linear infinite;
           z-index: 2;
       }
       
       /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –ê–ù–ò–ú–ê–¶–ò–ò */
       @keyframes bounceIn {
           0% { opacity: 0; transform: scale(0.3) translateY(50px); }
           50% { opacity: 1; transform: scale(1.05) translateY(-10px); }
           70% { transform: scale(0.9) translateY(0); }
           100% { opacity: 1; transform: scale(1) translateY(0); }
       }

       @keyframes fadeInUp {
           0% { opacity: 0; transform: translateY(40px); }
           100% { opacity: 1; transform: translateY(0); }
       }
       
       @keyframes slideUpBanner {
           0% { opacity: 0; transform: translateY(100%); }
           100% { opacity: 1; transform: translateY(0); }
       }
       
       @keyframes sparkle {
           0%, 100% { opacity: 1; transform: scale(1); }
           50% { opacity: 0.7; transform: scale(1.1); }
       }
       
       @keyframes neonGradient {
           0% { background-position: 0% 50%; }
           50% { background-position: 100% 50%; }
           100% { background-position: 0% 50%; }
       }

       @keyframes neonPulse {
           0%, 100% { opacity: 0.6; }
           50% { opacity: 1; }
       }

       @keyframes neonSweep {
           0% { transform: translateX(-100%) rotate(45deg); }
           100% { transform: translateX(400%) rotate(45deg); }
       }
       
       /* ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –≠–ö–†–ê–ù–´ –ó–ê–ì–†–£–ó–ö–ò –ò –û–®–ò–ë–û–ö */
       .loading-screen {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           display: flex;
           flex-direction: column;
           justify-content: center;
           align-items: center;
           z-index: 9999;
           color: #FFD700;
       }
       
       .loading-spinner {
           width: 60px;
           height: 60px;
           border: 5px solid rgba(255, 215, 0, 0.3);
           border-top: 5px solid #FFD700;
           border-radius: 50%;
           animation: spin 1s linear infinite;
           margin-bottom: 25px;
           box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
       }
       
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
       
       .loading-text {
           font-size: 20px;
           font-weight: bold;
           text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
           animation: pulse 2s ease-in-out infinite;
       }

       @keyframes pulse {
           0%, 100% { opacity: 1; }
           50% { opacity: 0.7; }
       }
       
       .error-screen {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           display: flex;
           flex-direction: column;
           justify-content: center;
           align-items: center;
           padding: 30px;
           text-align: center;
           z-index: 9999;
       }
       
       .error-icon {
           font-size: 80px;
           margin-bottom: 25px;
           animation: shake 0.5s ease-in-out;
       }

       @keyframes shake {
           0%, 100% { transform: translateX(0); }
           25% { transform: translateX(-5px); }
           75% { transform: translateX(5px); }
       }
       
       .error-title {
           color: #FFD700;
           font-size: 28px;
           font-weight: bold;
           margin-bottom: 18px;
           text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
       }
       
       .error-text {
           color: #FFFFFF;
           font-size: 18px;
           margin-bottom: 35px;
           line-height: 1.6;
           max-width: 400px;
           text-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
       }
       
       .error-button {
           background: linear-gradient(45deg, #FFD700, #FFA500);
           color: #000;
           border: none;
           padding: 18px 35px;
           border-radius: 30px;
           font-size: 18px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s ease;
           text-decoration: none;
           display: inline-block;
           box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
       }
       
       .error-button:hover {
           background: linear-gradient(45deg, #FFE55C, #FFB700);
           transform: translateY(-3px);
           box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
       }
       
       /* ‚úÖ –ú–û–ë–ò–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø */
       @media (max-width: 480px) {
           .mobile-container {
               width: 95vw;
               height: 85vh;
               margin: 2.5vh auto;
               border-radius: 25px;
           }
           
           .card-content {
               padding: 50px 20px 50px 20px;
           }
           
           .card-title {
               font-size: 22px;
           }
           
           .card-subtitle {
               font-size: 16px;
           }
           
           .greeting-text {
               font-size: 14px;
               max-width: 280px;
           }

           .video-container {
               border-radius: 0;
           }
           
           .sound-control-btn {
               top: 12px;
               right: 12px;
               padding: 8px 12px;
               font-size: 11px;
           }

           .action-button {
               padding: 12px 25px;
               font-size: 14px;
           }

           .bottom-area {
               padding: 15px;
           }

           .language-switcher {
               top: 5px;
               right: 5px;
               padding: 2px;
           }

           .lang-btn {
               padding: 4px 6px;
               font-size: 10px;
               min-width: 24px;
           }
       }

       @media (max-width: 360px) {
           .mobile-container {
               width: 98vw;
               height: 90vh;
               margin: 1vh auto;
           }

           .card-title {
               font-size: 20px;
           }

           .card-subtitle {
               font-size: 14px;
           }

           .greeting-text {
               font-size: 13px;
           }
       }
       
       /* ‚úÖ –°–ö–†–´–¢–ò–ï –≠–õ–ï–ú–ï–ù–¢–û–í */
       .hidden {
           display: none !important;
       }

       /* ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø */
       .card-area.has-video .card-content {
           background: rgba(0, 0, 0, 0.3);
           backdrop-filter: blur(5px);
           border-radius: 15px;
           margin: 20px;
           padding-top: 60px;
           padding-bottom: 60px;
       }

       .user-level-indicator {
           position: absolute;
           top: 40px;
           left: 15px;
           background: rgba(0, 0, 0, 0.8);
           color: #FFD700;
           padding: 4px 8px;
           border-radius: 12px;
           font-size: 10px;
           font-weight: bold;
           z-index: 15;
           backdrop-filter: blur(10px);
           border: 1px solid rgba(255, 215, 0, 0.3);
       }

       /* ‚úÖ –¢–ï–ú–ê –î–õ–Ø –¢–ï–ú–ù–û–ì–û –†–ï–ñ–ò–ú–ê */
       @media (prefers-color-scheme: dark) {
           .loading-screen,
           .error-screen {
               background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
           }
       }
   </style>
</head>
<body>
   <!-- ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –Ø–ó–´–ö–û–í–û–ô –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ -->
   <div class="language-switcher">
       <button class="lang-btn" onclick="changeLanguage('en')" id="lang-en">EN</button>
       <button class="lang-btn" onclick="changeLanguage('ru')" id="lang-ru">RU</button>
       <button class="lang-btn active" onclick="changeLanguage('ua')" id="lang-ua">UA</button>
   </div>

   <!-- ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
   <div id="loadingScreen" class="loading-screen">
       <div class="loading-spinner"></div>
       <div class="loading-text" id="loadingText">Loading card...</div>
       <div style="margin-top: 20px; font-size: 14px; opacity: 0.7;" id="loadingSubtext">Powered by CardGift Web3</div>
   </div>
   
   <!-- ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –≠–ö–†–ê–ù –û–®–ò–ë–ö–ò -->
   <div id="errorScreen" class="error-screen hidden">
       <div class="error-icon">üòî</div>
       <div class="error-title" id="errorTitle">Card not found</div>
       <div class="error-text" id="errorText">Check the link or create a new card</div>
       <a href="/generator.html" class="error-button" id="errorButton">Create Card</a>
       <div style="margin-top: 20px; font-size: 12px; opacity: 0.6;" id="errorSubtext">CardGift - Web3 Digital Cards</div>
   </div>

   <!-- ‚úÖ –û–°–ù–û–í–ù–ê–Ø –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò -->
   <div id="mainCard" class="mobile-container hidden">
       <!-- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
       <div id="userLevelIndicator" class="user-level-indicator hidden"></div>

       <!-- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –±–∞—Ä -->
       <div class="status-bar">
           <div class="status-left">
               <span style="font-size: 14px;">üîã</span>
               <span style="font-size: 12px;">üì∂</span>
               <span style="font-size: 11px;">üì¥</span>
           </div>
           <div class="status-right">
               <span id="currentTime">12:34</span>
           </div>
       </div>
       
       <!-- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ -->
       <div class="top-marquee" id="topMarquee" onclick="handleMarqueeClick()">
           <div class="marquee-content" id="marqueeContent">
               <!-- –¢–µ–∫—Å—Ç –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ -->
           </div>
       </div>
       
       <!-- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–∞—Ä—Ç—ã -->
       <div class="card-area" id="cardArea">
           <!-- –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–≤–∏–¥–µ–æ -->
           <div class="background-image" id="backgroundImage"></div>
           
           <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö -->
           <div class="card-content" id="cardContent">
               <div class="card-title" id="cardTitle">üéâ Welcome to CardGift! üåü</div>
               <div class="card-subtitle" id="cardSubtitle">Create amazing digital cards with Web3</div>
               <div class="greeting-text" id="greetingText">This is a demonstration card with Web3 integration and enhanced features.</div>
           </div>
       </div>
       
       <!-- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∏–∂–Ω—è—è –æ–±–ª–∞—Å—Ç—å -->
       <div class="bottom-area">
           <!-- CTA —Å–µ–∫—Ü–∏—è -->
           <div class="cta-section" id="ctaSection">
               <div class="cta-text" id="ctaText">Welcome to CardGift! üéâ</div>
               <div class="cta-subtitle" id="ctaSubtitle">This is a demo card with Web3 integration.</div>
           </div>
           
           <!-- –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
           <button class="action-button" id="actionButton" onclick="handleActionClick()">
               Get Started
           </button>
       </div>
       
       <!-- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –Ω–∏–∂–Ω–∏–π –±–∞–Ω–Ω–µ—Ä -->
       <div class="bottom-banner" id="bottomBanner" onclick="handleBottomBannerClick()">
           <span id="bottomBannerText">üéÅ CardGift - Web3 Digital Cards</span>
       </div>
   </div>

   <script>
       // ‚úÖ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
       let cardId = null;
       let cardData = null;
       let currentLanguage = 'en';
       let currentUrl = window.location.href;
       let viewStartTime = Date.now();
       let isDemo = false;
       
       // ‚úÖ –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò URL –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
       function cleanUrl(url) {
           if (!url || typeof url !== 'string') return '';
           
           // –î–µ–∫–æ–¥–∏—Ä—É–µ–º HTML entities
           let cleanedUrl = url
               .replace(/&amp;/g, '&')
               .replace(/&#x2F;/g, '/')
               .replace(/&lt;/g, '<')
               .replace(/&gt;/g, '>')
               .replace(/&quot;/g, '"')
               .replace(/&#x27;/g, "'");
           
           // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å URL
           try {
               if (cleanedUrl.startsWith('http://') || cleanedUrl.startsWith('https://')) {
                   new URL(cleanedUrl);
                   return cleanedUrl;
               } else if (cleanedUrl.startsWith('/')) {
                   // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL
                   return cleanedUrl;
               }
           } catch (e) {
               console.warn('Invalid URL:', cleanedUrl);
           }
           
           return '';
       }
       
       // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –ü–ï–†–ï–í–û–î–´
       const translations = {
           en: {
               loading: "Loading card...",
               loadingSubtext: "Powered by CardGift Web3",
               error: "Error",
               cardNotFound: "Card not found",
               checkLink: "Check the link or create a new card",
               createCard: "Create Card",
               errorSubtext: "CardGift - Web3 Digital Cards",
               ctaText: "Welcome to CardGift! üéâ",
               ctaSubtitle: "This is a demo card with Web3 integration.",
               bottomBanner: "üéÅ CardGift - Web3 Digital Cards",
               actionButton: "Get Started",
               marqueeText: "Welcome to CardGift - Create amazing Web3 cards!",
               demoTitle: "üéâ Welcome to CardGift! üåü",
               demoSubtitle: "Create amazing digital cards with Web3",
               demoText: "This is a demonstration card with Web3 integration and enhanced features.",
               userLevel: "Level"
           },
           ru: {
               loading: "–ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∫—É...",
               loadingSubtext: "–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CardGift Web3",
               error: "–û—à–∏–±–∫–∞",
               cardNotFound: "–û—Ç–∫—Ä—ã—Ç–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
               checkLink: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –æ—Ç–∫—Ä—ã—Ç–∫—É",
               createCard: "–°–æ–∑–¥–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É",
               errorSubtext: "CardGift - Web3 —Ü–∏—Ñ—Ä–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏",
               ctaText: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CardGift! üéâ",
               ctaSubtitle: "–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ —Å Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π.",
               bottomBanner: "üéÅ CardGift - Web3 —Ü–∏—Ñ—Ä–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏",
               actionButton: "–ù–∞—á–∞—Ç—å",
               marqueeText: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CardGift - –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ Web3 –æ—Ç–∫—Ä—ã—Ç–∫–∏!",
               demoTitle: "üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CardGift! üåü",
               demoSubtitle: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ —Å Web3",
               demoText: "–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ —Å Web3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.",
               userLevel: "–£—Ä–æ–≤–µ–Ω—å"
           },
           ua: {
               loading: "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ª–∏—Å—Ç—ñ–≤–∫—É...",
               loadingSubtext: "–ü—Ä–∞—Ü—é—î –Ω–∞ CardGift Web3",
               error: "–ü–æ–º–∏–ª–∫–∞",
               cardNotFound: "–õ–∏—Å—Ç—ñ–≤–∫—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ",
               checkLink: "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –ª–∏—Å—Ç—ñ–≤–∫—É",
               createCard: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∏—Å—Ç—ñ–≤–∫—É",
               errorSubtext: "CardGift - Web3 —Ü–∏—Ñ—Ä–æ–≤—ñ –ª–∏—Å—Ç—ñ–≤–∫–∏",
               ctaText: "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ CardGift! üéâ",
               ctaSubtitle: "–¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∞ –ª–∏—Å—Ç—ñ–≤–∫–∞ –∑ Web3 —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é.",
               bottomBanner: "üéÅ CardGift - Web3 —Ü–∏—Ñ—Ä–æ–≤—ñ –ª–∏—Å—Ç—ñ–≤–∫–∏",
               actionButton: "–ü–æ—á–∞—Ç–∏",
               marqueeText: "–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ CardGift - –°—Ç–≤–æ—Ä—é–π—Ç–µ –¥–∏–≤–æ–≤–∏–∂–Ω—ñ Web3 –ª–∏—Å—Ç—ñ–≤–∫–∏!",
               demoTitle: "üéâ –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ CardGift! üåü",
               demoSubtitle: "–°—Ç–≤–æ—Ä—é–π—Ç–µ –¥–∏–≤–æ–≤–∏–∂–Ω—ñ —Ü–∏—Ñ—Ä–æ–≤—ñ –ª–∏—Å—Ç—ñ–≤–∫–∏ –∑ Web3",
               demoText: "–¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∞ –ª–∏—Å—Ç—ñ–≤–∫–∞ –∑ Web3 —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é —Ç–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–º–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏.",
               userLevel: "–†—ñ–≤–µ–Ω—å"
           }
       };

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
      document.addEventListener('DOMContentLoaded', function() {
          console.log('üì± CardGift Enhanced Card Viewer v3.0 LOADING...');
          
          cardId = getCardIdFromUrl();
          initializeLanguage();
          updateTime();
          showUserLevel();
          loadAndDisplayCard();
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
          setInterval(updateTime, 60000);
          
          // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
          trackViewStart();
      });

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–û–ï –í–†–ï–ú–Ø –í –°–¢–ê–¢–£–° –ë–ê–†–ï
      function updateTime() {
          const now = new Date();
          const timeString = now.toLocaleTimeString(currentLanguage === 'en' ? 'en-US' : 'ru-RU', { 
              hour: '2-digit', 
              minute: '2-digit',
              hour12: false
          });
          const timeElement = document.getElementById('currentTime');
          if (timeElement) {
              timeElement.textContent = timeString;
          }
      }

      // ‚úÖ –ü–û–ö–ê–ó –£–†–û–í–ù–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
      function showUserLevel() {
          const userLevel = levelManager.getUserLevel();
          const levelInfo = levelManager.getLevelInfo(userLevel);
          const indicator = document.getElementById('userLevelIndicator');
          
          if (indicator && userLevel > 0) {
              indicator.textContent = `${translations[currentLanguage].userLevel} ${levelInfo.name}`;
              indicator.classList.remove('hidden');
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –Ø–ó–´–ö–û–í–´–ï –§–£–ù–ö–¶–ò–ò
      function changeLanguage(lang) {
          currentLanguage = lang;
          localStorage.setItem('cardGift_language', lang);
          
          document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
          document.getElementById(`lang-${lang}`).classList.add('active');
          
          updateTexts();
          console.log('üåç Language changed to:', lang);
          
          // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
          cardNotifications.show(
              `Language changed to ${lang.toUpperCase()}`,
              'info',
              2000
          );
      }

      function initializeLanguage() {
          const urlParams = new URLSearchParams(window.location.search);
          const langParam = urlParams.get('lang');
          const savedLang = localStorage.getItem('cardGift_language');
          
          if (langParam && ['en', 'ru', 'ua'].includes(langParam)) {
              currentLanguage = langParam;
          } else if (savedLang && ['en', 'ru', 'ua'].includes(savedLang)) {
              currentLanguage = savedLang;
          } else {
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –±—Ä–∞—É–∑–µ—Ä–∞
              const browserLang = navigator.language || navigator.userLanguage;
              if (browserLang.startsWith('uk')) {
                  currentLanguage = 'ua';
              } else if (browserLang.startsWith('ru')) {
                  currentLanguage = 'ru';
              } else {
                  currentLanguage = 'en';
              }
          }
          
          document.documentElement.lang = currentLanguage;
          document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
          const activeBtn = document.getElementById(`lang-${currentLanguage}`);
          if (activeBtn) {
              activeBtn.classList.add('active');
          }
          
          updateTexts();
      }

      function updateTexts() {
          const t = translations[currentLanguage];
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
          const textElements = {
              'loadingText': t.loading,
              'errorTitle': t.cardNotFound,
              'errorText': t.checkLink,
              'errorButton': t.createCard,
              'ctaText': t.ctaText,
              'ctaSubtitle': t.ctaSubtitle,
              'bottomBannerText': t.bottomBanner,
              'actionButton': t.actionButton
          };

          Object.keys(textElements).forEach(elementId => {
              const element = document.getElementById(elementId);
              if (element) {
                  element.textContent = textElements[elementId];
              }
          });

          // –û–±–Ω–æ–≤–ª—è–µ–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          document.getElementById('pageTitle').textContent = `CardGift - ${t.cardNotFound}`;
      }

      // ‚úÖ –ü–û–õ–£–ß–ï–ù–ò–ï ID –ö–ê–†–¢–´ –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
      function getCardIdFromUrl() {
          const urlParams = new URLSearchParams(window.location.search);
          let id = urlParams.get('id') || window.location.hash.replace('#', '');
          
          // –û—á–∏—â–∞–µ–º ID –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
          if (id) {
              id = id.replace(/[^a-zA-Z0-9_-]/g, '');
          }
          
          console.log('üîç Card ID from URL:', id || 'none');
          return id || null;
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ö–ê–†–¢–´
      async function loadAndDisplayCard() {
          try {
              console.log('üîÑ Loading card with ID:', cardId);
              
              if (!cardId) {
                  console.log('üìù No card ID, showing enhanced demo');
                  displayDemoCard();
                  return;
              }
              
              // –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö
              cardData = await findCardData(cardId);
              
              if (cardData) {
                  console.log('‚úÖ Card found:', cardData);
                  displayCard(cardData);
              } else {
                  console.log('üé≠ Card not found, showing enhanced demo');
                  displayDemoCard();
              }
              
          } catch (error) {
              console.error('‚ùå Loading error:', error);
              showError();
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –ü–û–ò–°–ö –î–ê–ù–ù–´–• –ö–ê–†–¢–´
      async function findCardData(cardId) {
          console.log('üîç Searching for card:', cardId);
          
          // 1. –ü—Ä–æ–±—É–µ–º API —Å–µ—Ä–≤–µ—Ä–∞
          try {
              const response = await fetch(`/api/card/${cardId}`, {
                  method: 'GET',
                  headers: {
                      'Accept': 'application/json',
                      'Cache-Control': 'no-cache'
                  }
              });
              
              if (response.ok) {
                  const result = await response.json();
                  if (result.success && result.data) {
                      console.log('‚úÖ Card found on server:', cardId);
                      trackEvent('card_loaded_from_server', { cardId });
                      return result.data;
                  }
              }
          } catch (error) {
              console.warn('‚ö†Ô∏è Server load error:', error);
          }

          // 2. Fallback API endpoint
          try {
              const response = await fetch(`/api/save-card?id=${cardId}`);
              if (response.ok) {
                  const result = await response.json();
                  if (result.success && result.data) {
                      console.log('‚úÖ Card found via fallback API:', cardId);
                      trackEvent('card_loaded_from_fallback', { cardId });
                      return result.data;
                  }
              }
          } catch (error) {
              console.warn('‚ö†Ô∏è Fallback API error:', error);
          }
          
          // 3. localStorage –ø–æ–∏—Å–∫
          try {
              let cardData = localStorage.getItem(`card_${cardId}`);
              if (cardData) {
                  const parsed = JSON.parse(cardData);
                  console.log('‚úÖ Card found in localStorage:', cardId);
                  trackEvent('card_loaded_from_local', { cardId });
                  return parsed;
              }
          } catch (error) {
              console.warn('‚ö†Ô∏è localStorage error:', error);
          }
          
          // 4. –ü–æ–∏—Å–∫ –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ userCards
          try {
              const userCards = localStorage.getItem('userCards');
              if (userCards) {
                  const userCardsData = JSON.parse(userCards);
                  for (const userId in userCardsData) {
                      const cards = userCardsData[userId] || [];
                      const found = cards.find(card => card.cardId === cardId);
                      if (found) {
                          console.log('‚úÖ Card found in legacy userCards:', cardId);
                          trackEvent('card_loaded_from_legacy', { cardId });
                          return found;
                      }
                  }
              }
          } catch (error) {
              console.warn('‚ö†Ô∏è Legacy search error:', error);
          }
          
          console.log('‚ùå Card not found anywhere:', cardId);
          trackEvent('card_not_found', { cardId });
          return null;
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –î–ï–ú–û –ö–ê–†–¢–ê
      function displayDemoCard() {
          isDemo = true;
          const demoStyles = ['classic', 'sunset', 'ocean', 'space', 'neon'];
          const randomStyle = demoStyles[Math.floor(Math.random() * demoStyles.length)];
          
          const t = translations[currentLanguage];
          
          cardData = {
              cardId: 'demo_card_' + Date.now(),
              userId: 'demo_user',
              userLevel: 0,
              greeting: `${t.demoTitle}\n${t.demoSubtitle}\n${t.demoText}`,
              style: randomStyle,
              backgroundImage: null,
              mediaType: null,
              mediaUrl: null,
              videoUrl: null,
              fontColor: '#FFFFFF',
              fontSize: 'medium',
              shareLink: currentUrl,
              createdAt: new Date().toISOString(),
              lastModified: new Date().toISOString(),
              views: Math.floor(Math.random() * 1000) + 1,
              isDemo: true,
              language: currentLanguage,
              
              // CTA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
              ctaEnabled: true,
              ctaTitle: t.ctaText,
              ctaSubtitle: t.ctaSubtitle,
              ctaButton: t.actionButton,
              ctaUrl: '/generator.html',
              ctaTimer: 3,
              
              // –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞
              marqueeEnabled: true,
              marqueeText: t.marqueeText,
              marqueeUrl: '/generator.html',
              marqueeTimer: 4,
              
              // –ù–∏–∂–Ω–∏–π –±–∞–Ω–Ω–µ—Ä
              bannerEnabled: true,
              bannerHtml: t.bottomBanner,
              bannerUrl: '/generator.html',
              bannerTimer: 6
          };
          
          console.log('üé≠ Displaying enhanced demo card with style:', randomStyle);
          displayCard(cardData);
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–º–æ
          setTimeout(() => {
              cardNotifications.show(
                  currentLanguage === 'en' ? 'üé≠ This is a demo card. Create your own!' :
                  currentLanguage === 'ru' ? 'üé≠ –≠—Ç–æ –¥–µ–º–æ –æ—Ç–∫—Ä—ã—Ç–∫–∞. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é!' :
                  'üé≠ –¶–µ –¥–µ–º–æ –ª–∏—Å—Ç—ñ–≤–∫–∞. –°—Ç–≤–æ—Ä—ñ—Ç—å —Å–≤–æ—é!',
                  'info',
                  4000
              );
          }, 2000);
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ö–ê–†–¢–´
      async function displayCard(data) {
          setTimeout(async () => {
              // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
              document.getElementById('loadingScreen').classList.add('hidden');
              document.getElementById('mainCard').classList.remove('hidden');
        	   
        	   // ‚úÖ –û–ë–ù–û–í–õ–Ø–ï–ú META-–¢–ï–ì–ò –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
              updateMetaTags(data);
        	   
              // ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å —Ñ–æ–Ω–∞
              const cardArea = document.getElementById('cardArea');
              if (data.style) {
                  cardArea.className = `card-area style-${data.style}`;
                  console.log('üé® Applied style:', data.style);
              }
              
              // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –ú–ï–î–ò–ê –ö–û–ù–¢–ï–ù–¢–ê
              await handleMediaContent(data);
              
              // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –¢–ï–ö–°–¢–ê
              handleTextContent(data);
              
              // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê CTA –≠–õ–ï–ú–ï–ù–¢–û–í
              handleCTAElements(data);
              
              // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–• –≠–õ–ï–ú–ï–ù–¢–û–í
              handleAdditionalElements(data);
              
              // ‚úÖ –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
              incrementViews(data);
              
              // ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
              trackEvent('card_displayed', {
                  cardId: data.cardId,
                  style: data.style,
                  hasVideo: !!(data.videoUrl || (data.mediaType === 'video')),
                  hasImage: !!(data.backgroundImage || data.mediaUrl),
                  isDemo: data.isDemo || false
              });
              
              console.log('‚úÖ Card displayed successfully');
              
          }, 1500);
      }

      // ‚úÖ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ú–ï–¢–ê-–¢–ï–ì–û–í
      function updateMetaTags(data) {
          if (data.greeting && data.greeting.trim()) {
              const greetingLines = data.greeting.split('\n').filter(line => line.trim());
              
              if (greetingLines.length > 0) {
                  const title = greetingLines[0] || 'CardGift - Digital Card';
                  const description = greetingLines.length > 1 ? 
                      greetingLines[1] : 
                      'Beautiful personalized card created with CardGift Web3 platform';
                  
                  // –û–±–Ω–æ–≤–ª—è–µ–º title —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                  document.title = `${title} - CardGift`;
                  document.getElementById('pageTitle').textContent = `${title} - CardGift`;
                  
                  // –û–±–Ω–æ–≤–ª—è–µ–º Open Graph
                  document.getElementById('ogTitle').content = title;
                  document.getElementById('ogDescription').content = description;
                  document.getElementById('ogUrl').content = window.location.href;
                  
                  // –û–±–Ω–æ–≤–ª—è–µ–º Twitter Card
                  document.getElementById('twitterTitle').content = title;
                  document.getElementById('twitterDescription').content = description;
                  
                  console.log('‚úÖ Meta tags updated:', { title, description });
              }
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –ú–ï–î–ò–ê –ö–û–ù–¢–ï–ù–¢–ê
      async function handleMediaContent(data) {
          const bgElement = document.getElementById('backgroundImage');
          const cardContent = document.getElementById('cardContent');
          
          // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
          bgElement.innerHTML = '';
          bgElement.style.backgroundImage = 'none';
          cardContent.classList.remove('has-video');
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ
          if (data.mediaType === 'video' && data.mediaUrl && data.mediaUrl.startsWith('data:video/')) {
              console.log('üé¨ Processing local video');
              
              const videoElement = document.createElement('video');
              videoElement.src = data.mediaUrl;
              videoElement.style.cssText = `
                  width: 100%; 
                  height: 100%; 
                  object-fit: cover; 
                  position: absolute; 
                  top: 0; 
                  left: 0; 
                  z-index: 2;
              `;
              videoElement.controls = true;
              videoElement.loop = true;
              videoElement.muted = true;
              videoElement.autoplay = true;
              videoElement.playsinline = true;

              videoElement.addEventListener('loadeddata', () => {
                  videoElement.play().catch(e => console.log('Autoplay failed'));
              });

              bgElement.appendChild(videoElement);
              cardContent.classList.add('has-video');
              
              // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
              setTimeout(() => {
                  createSoundButton(videoElement);
              }, 500);
          }
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ URL (YouTube, TikTok, Instagram)
          else if (data.videoUrl && data.videoUrl.trim()) {
              console.log('üé¨ Processing video URL:', data.videoUrl);
              
              const cleanVideoUrl = cleanUrl(data.videoUrl);
              if (cleanVideoUrl) {
                  const videoData = videoProcessor.parseVideoUrl(cleanVideoUrl);
                  if (videoData.isValid) {
                      console.log('‚úÖ Valid video data:', videoData);
                      videoProcessor.createEnhancedVideoElement(videoData, bgElement);
                      cardContent.classList.add('has-video');
                  } else {
                      console.warn('‚ùå Invalid video URL:', cleanVideoUrl);
                      showVideoError(bgElement, videoData.error);
                  }
              }
          }
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
          else if (data.backgroundImage || data.mediaUrl) {
              const imageUrl = data.backgroundImage || data.mediaUrl;
              console.log('üñºÔ∏è Processing image:', imageUrl);
              
              bgElement.style.backgroundImage = `url(${imageUrl})`;
              bgElement.style.backgroundSize = 'contain';
              bgElement.style.backgroundPosition = 'center';
              bgElement.style.backgroundRepeat = 'no-repeat';
          }
      }

      // ‚úÖ –°–û–ó–î–ê–ù–ò–ï –ö–ù–û–ü–ö–ò –ó–í–£–ö–ê –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–û–ì–û –í–ò–î–ï–û
      function createSoundButton(videoElement) {
          const cardArea = document.getElementById('cardArea');
          const soundButton = document.createElement('button');
          soundButton.innerHTML = 'üîä Sound';
          soundButton.className = 'sound-control-btn';
          soundButton.id = 'localVideoSoundBtn';
          
          soundButton.onclick = () => {
              videoElement.muted = false;
              videoElement.play();
              soundButton.innerHTML = 'üîä ON';
              soundButton.style.background = 'rgba(76, 175, 80, 0.8)';
              soundButton.style.borderColor = '#4CAF50';
              
              setTimeout(() => {
                  soundButton.style.opacity = '0';
                  setTimeout(() => soundButton.remove(), 300);
              }, 2000);
              
              cardNotifications.show('üîä Sound enabled!', 'success', 2000);
          };
          
          cardArea.appendChild(soundButton);
      }

      // ‚úÖ –ü–û–ö–ê–ó –û–®–ò–ë–ö–ò –í–ò–î–ï–û
      function showVideoError(container, message) {
          container.innerHTML = `
              <div style="
                  position: absolute;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  background: rgba(255, 68, 68, 0.9);
                  color: white;
                  padding: 20px;
                  border-radius: 15px;
                  text-align: center;
                  z-index: 10;
                  font-weight: bold;
                  max-width: 80%;
                  backdrop-filter: blur(10px);
              ">
                  <div style="font-size: 32px; margin-bottom: 10px;">‚ùå</div>
                  <div>${message || 'Video loading error'}</div>
              </div>
          `;
      }

      // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–ï–ö–°–¢–û–í–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê
      function handleTextContent(data) {
          let title = '';
          let subtitle = '';
          let mainText = '';

          if (data.greeting && data.greeting.trim()) {
              const greetingLines = data.greeting.split('\n').filter(line => line.trim());
              
              if (greetingLines.length > 0) {
                  title = greetingLines[0];
                  if (greetingLines.length > 1) {
                      subtitle = greetingLines[1];
                  }
                  if (greetingLines.length > 2) {
                      mainText = greetingLines.slice(2).join('\n');
                  }
              }
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏–¥–µ–æ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Ç–µ–∫—Å—Ç–∞
          const hasVideo = (data.videoUrl && data.videoUrl.trim()) || 
                          (data.mediaType === 'video' && data.mediaUrl);
          
          const titleElement = document.getElementById('cardTitle');
          const subtitleElement = document.getElementById('cardSubtitle');
          const textElement = document.getElementById('greetingText');

          if (hasVideo) {
              // –°–∫—Ä—ã–≤–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
              titleElement.style.display = 'none';
              subtitleElement.style.display = 'none';
              textElement.style.display = 'none';
          } else {
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç—ã
              titleElement.textContent = title;
              titleElement.style.display = title ? 'block' : 'none';
              
              subtitleElement.textContent = subtitle;
              subtitleElement.style.display = subtitle ? 'block' : 'none';
              
              textElement.textContent = mainText;
              textElement.style.display = mainText ? 'block' : 'none';
          }
      }

      // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê CTA –≠–õ–ï–ú–ï–ù–¢–û–í
      function handleCTAElements(data) {
          const ctaSection = document.getElementById('ctaSection');
          const actionButton = document.getElementById('actionButton');
          
          if (data.ctaEnabled && data.ctaTitle && data.ctaButton) {
              document.getElementById('ctaText').textContent = data.ctaTitle;
              document.getElementById('ctaSubtitle').textContent = data.ctaSubtitle || '';
              actionButton.textContent = data.ctaButton;
              
              const buttonDelay = (data.ctaTimer || 3) * 1000;
              setTimeout(() => {
                  ctaSection.classList.add('show');
                  actionButton.classList.add('show');
                  console.log('‚úÖ CTA shown after', data.ctaTimer, 'seconds');
                  
                  trackEvent('cta_shown', {
                      cardId: data.cardId,
                      delay: data.ctaTimer
                  });
              }, buttonDelay);
          } else {
              ctaSection.classList.remove('show');
              actionButton.classList.remove('show');
          }
      }

      // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–• –≠–õ–ï–ú–ï–ù–¢–û–í
      function handleAdditionalElements(data) {
          // –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞
          const topMarquee = document.getElementById('topMarquee');
          if (data.marqueeEnabled && data.marqueeText) {
              document.getElementById('marqueeContent').textContent = data.marqueeText;
              const marqueeDelay = (data.marqueeTimer || 5) * 1000;
              setTimeout(() => {
                  topMarquee.classList.add('show');
                  console.log('‚úÖ Marquee shown after', data.marqueeTimer, 'seconds');
                  
                  trackEvent('marquee_shown', {
                      cardId: data.cardId,
                      delay: data.marqueeTimer
                  });
              }, marqueeDelay);
          } else {
              topMarquee.classList.remove('show');
          }
          
          // –ù–∏–∂–Ω–∏–π –±–∞–Ω–Ω–µ—Ä
          const bottomBanner = document.getElementById('bottomBanner');
          if (data.bannerEnabled && (data.bannerHtml || data.bannerUrl)) {
              const bannerDelay = (data.bannerTimer || 8) * 1000;
              setTimeout(() => {
                  bottomBanner.classList.add('show');
                  if (data.bannerHtml) {
                      document.getElementById('bottomBannerText').innerHTML = data.bannerHtml;
                  }
                  console.log('‚úÖ Bottom banner shown after', data.bannerTimer || 8, 'seconds');
                  
                  trackEvent('banner_shown', {
                      cardId: data.cardId,
                      delay: data.bannerTimer || 8
                  });
              }, bannerDelay);
          } else {
              bottomBanner.classList.remove('show');
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ô –°–ß–ï–¢–ß–ò–ö –ü–†–û–°–ú–û–¢–†–û–í
      function incrementViews(data) {
          if (data.isDemo) return;
          
          try {
              data.views = (data.views || 0) + 1;
              data.lastViewed = new Date().toISOString();
              data.viewDuration = Date.now() - viewStartTime;
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
              localStorage.setItem(`card_${data.cardId}`, JSON.stringify(data));
              
              console.log('üìä View counted:', data.views);
              
              trackEvent('view_counted', {
                  cardId: data.cardId,
                  views: data.views,
                  duration: data.viewDuration
              });
          } catch (error) {
              console.warn('‚ö†Ô∏è Error updating views:', error);
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
      
      function handleMarqueeClick() {
          console.log('üéØ Marquee clicked');
          
          trackEvent('marquee_clicked', {
              cardId: cardData?.cardId || 'demo'
          });
          
          if (cardData && cardData.marqueeUrl && cardData.marqueeUrl.trim()) {
              const cleanedUrl = cleanUrl(cardData.marqueeUrl);
              if (cleanedUrl) {
                  window.open(cleanedUrl, '_blank');
              } else {
                  window.open('/generator.html', '_blank');
              }
          } else {
              window.open('/generator.html', '_blank');
          }
      }

      function handleActionClick() {
          console.log('üéØ Action button clicked');
          
          trackEvent('action_button_clicked', {
              cardId: cardData?.cardId || 'demo'
          });
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
          cardNotifications.show(
              currentLanguage === 'en' ? 'üöÄ Redirecting to CardGift...' :
              currentLanguage === 'ru' ? 'üöÄ –ü–µ—Ä–µ—Ö–æ–¥ –≤ CardGift...' :
              'üöÄ –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ CardGift...',
              'info',
              2000
          );
          
          if (cardData && cardData.ctaUrl && cardData.ctaUrl.trim()) {
              const cleanedUrl = cleanUrl(cardData.ctaUrl);
              if (cleanedUrl) {
                  setTimeout(() => window.open(cleanedUrl, '_blank'), 500);
              } else {
                  setTimeout(() => window.open('/generator.html', '_blank'), 500);
              }
          } else {
              setTimeout(() => window.open('/generator.html', '_blank'), 500);
          }
      }

      function handleBottomBannerClick() {
          console.log('üéØ Bottom banner clicked');
          
          trackEvent('banner_clicked', {
              cardId: cardData?.cardId || 'demo'
          });
          
          if (cardData && cardData.bannerUrl && cardData.bannerUrl.trim()) {
              const cleanedUrl = cleanUrl(cardData.bannerUrl);
              if (cleanedUrl) {
                  window.open(cleanedUrl, '_blank');
              } else {
                  window.open('/generator.html', '_blank');
              }
          } else {
              window.open('/generator.html', '_blank');
          }
      }

      // ‚úÖ –ü–û–ö–ê–ó –û–®–ò–ë–ö–ò –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
      function showError() {
          document.getElementById('loadingScreen').classList.add('hidden');
          document.getElementById('errorScreen').classList.remove('hidden');
          
          trackEvent('error_shown', {
              cardId: cardId || 'none',
              url: currentUrl
          });
      }

      // ‚úÖ –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –ù–ê–ß–ê–õ–ê –ü–†–û–°–ú–û–¢–†–ê
      function trackViewStart() {
          viewStartTime = Date.now();
          trackEvent('view_started', {
              cardId: cardId || 'demo',
              language: currentLanguage,
              userAgent: navigator.userAgent,
              referrer: document.referrer
          });
      }

      // ‚úÖ WEB3 –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
      async function initWeb3() {
          if (typeof window.ethereum !== 'undefined') {
              console.log('üîó Web3 wallet detected');
              
              try {
                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
                  const accounts = await window.ethereum.request({ 
                      method: 'eth_accounts' 
                  });
                  
                  if (accounts.length > 0) {
                      console.log('‚úÖ Wallet already connected:', accounts[0]);
                      
                      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å
                      const chainId = await window.ethereum.request({ 
                          method: 'eth_chainId' 
                      });
                      const currentChainId = parseInt(chainId, 16);
                      
                      if (currentChainId === 204) {
                          cardNotifications.show('‚úÖ Connected to opBNB', 'success', 3000);
                      } else {
                          cardNotifications.show('‚ö†Ô∏è Switch to opBNB network', 'warning', 4000);
                      }
                      
                      return accounts[0];
                  }
              } catch (error) {
                  console.warn('‚ö†Ô∏è Web3 check error:', error);
              }
          }
          
          return null;
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –®–ï–†–ò–ù–ì–ê
      function shareCard() {
          const title = document.getElementById('cardTitle').textContent || 'CardGift Card';
          const text = document.getElementById('greetingText').textContent || 'Check out this card!';
          
          trackEvent('share_attempted', {
              cardId: cardData?.cardId || 'demo',
              method: navigator.share ? 'native' : 'clipboard'
          });
          
          if (navigator.share) {
              navigator.share({
                  title: title,
                  text: text,
                  url: currentUrl,
              }).then(() => {
                  cardNotifications.show('üì± Shared successfully!', 'success', 3000);
                  trackEvent('share_completed', { method: 'native' });
              }).catch((error) => {
                  console.log('Share cancelled or failed:', error);
              });
          } else {
              // Fallback - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
              const shareText = `${title}\n${text}\n${currentUrl}`;
              
              if (navigator.clipboard) {
                  navigator.clipboard.writeText(shareText).then(() => {
                      cardNotifications.show('üìã Link copied to clipboard!', 'success', 3000);
                      trackEvent('share_completed', { method: 'clipboard' });
                  });
              } else {
                  // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                  const textArea = document.createElement('textarea');
                  textArea.value = shareText;
                  document.body.appendChild(textArea);
                  textArea.select();
                  document.execCommand('copy');
                  document.body.removeChild(textArea);
                  
                  cardNotifications.show('üìã Link copied!', 'success', 3000);
                  trackEvent('share_completed', { method: 'legacy_clipboard' });
              }
          }
      }

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–´–ï –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò
      document.addEventListener('keydown', function(e) {
          // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
              return;
          }
          
          switch(e.key.toLowerCase()) {
              case 'escape':
                  // –ó–∞–∫—Ä—ã—Ç—å –ª—é–±—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                  document.querySelectorAll('[style*="position: fixed"]').forEach(el => {
                      if (el.style.zIndex === '10000') {
                          el.remove();
                      }
                  });
                  trackEvent('escape_pressed');
                  break;
                  
              case 's':
                  if (e.ctrlKey || e.metaKey) {
                      e.preventDefault();
                      shareCard();
                  }
                  break;
                  
              case 'r':
                  if (e.ctrlKey || e.metaKey) {
                      e.preventDefault();
                      location.reload();
                  }
                  break;
                  
              case 'f':
                  if (e.ctrlKey || e.metaKey) {
                      e.preventDefault();
                      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                      if (!document.fullscreenElement) {
                          document.documentElement.requestFullscreen();
                      } else {
                          document.exitFullscreen();
                      }
                  }
                  break;
                  
              case ' ':
                  // –ü–∞—É–∑–∞/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ
                  const videos = document.querySelectorAll('video');
                  videos.forEach(video => {
                      if (video.paused) {
                          video.play();
                      } else {
                          video.pause();
                      }
                  });
                  e.preventDefault();
                  break;
          }
      });

      // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê
      function trackEvent(eventName, eventData = {}) {
          const analyticsData = {
              event: eventName,
              cardId: cardData?.cardId || 'demo',
              timestamp: new Date().toISOString(),
              userAgent: navigator.userAgent,
              language: currentLanguage,
              url: currentUrl,
              viewportWidth: window.innerWidth,
              viewportHeight: window.innerHeight,
              referrer: document.referrer || 'direct',
              ...eventData
          };
          
          console.log('üìä Event tracked:', analyticsData);
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
          try {
              const events = JSON.parse(localStorage.getItem('cardGift_analytics') || '[]');
              events.push(analyticsData);
              
              // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–æ–±—ã—Ç–∏–π
              if (events.length > 100) {
                  events.splice(0, events.length - 100);
              }
              
              localStorage.setItem('cardGift_analytics', JSON.stringify(events));
          } catch (error) {
              console.warn('Analytics storage error:', error);
          }
      }

      // ‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –° –£–õ–£–ß–®–ï–ù–ò–Ø–ú–ò
      window.addEventListener('error', function(e) {
          console.error('‚ùå Global error:', e.error);
          
          trackEvent('javascript_error', {
              message: e.message,
              filename: e.filename,
              line: e.lineno,
              column: e.colno,
              stack: e.error?.stack
          });
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
          if (e.message && (e.message.includes('fetch') || e.message.includes('network'))) {
              cardNotifications.show(
                  currentLanguage === 'en' ? 'Network error occurred' :
                  currentLanguage === 'ru' ? '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏' :
                  '–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ',
                  'error',
                  4000
              );
          }
      });

      // ‚úÖ –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –í–ò–î–ò–ú–û–°–¢–ò –°–¢–†–ê–ù–ò–¶–´
      document.addEventListener('visibilitychange', function() {
          if (document.hidden) {
              trackEvent('page_hidden', {
                  viewDuration: Date.now() - viewStartTime
              });
          } else {
              trackEvent('page_visible');
              viewStartTime = Date.now(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏
          }
      });

      // ‚úÖ –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –°–ö–†–û–õ–õ–ê (–¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π)
      let scrollTrackingThrottle = false;
      window.addEventListener('scroll', function() {
          if (!scrollTrackingThrottle) {
              scrollTrackingThrottle = true;
              setTimeout(() => {
                  trackEvent('page_scrolled', {
                      scrollY: window.scrollY,
                      scrollPercent: Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100)
                  });
                  scrollTrackingThrottle = false;
              }, 1000);
          }
      });

      // ‚úÖ –û–ß–ò–°–¢–ö–ê –†–ï–°–£–†–°–û–í –ü–†–ò –ó–ê–ö–†–´–¢–ò–ò
      window.addEventListener('beforeunload', function() {
          trackEvent('page_unload', {
              totalViewDuration: Date.now() - viewStartTime
          });
          
          // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
          const videos = document.querySelectorAll('video');
          videos.forEach(video => {
              video.pause();
              video.src = '';
          });
          
          console.log('üßπ Resources cleaned up');
      });

      // ‚úÖ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø WEB3 –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï
      setTimeout(() => {
          initWeb3();
      }, 2000);

      console.log('üì± CardGift Enhanced Card Viewer v3.0 –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
      console.log('üí° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: Ctrl+S (–ø–æ–¥–µ–ª–∏—Ç—å—Å—è), Ctrl+F (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω), Space (–ø–∞—É–∑–∞ –≤–∏–¥–µ–æ)');
      
      // ‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¢–õ–ê–î–û–ß–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
      if (window.location.search.includes('debug=true')) {
          window.cardViewerDebug = {
              cardData: () => cardData,
              currentLanguage: () => currentLanguage,
              trackEvent: trackEvent,
              showNotification: (msg, type) => cardNotifications.show(msg, type || 'info'),
              changeLanguage: changeLanguage,
              reloadCard: loadAndDisplayCard,
              analytics: () => JSON.parse(localStorage.getItem('cardGift_analytics') || '[]'),
              clearAnalytics: () => localStorage.removeItem('cardGift_analytics'),
              version: 'CardGift Card Viewer v3.0',
              features: [
                  'Enhanced video support (YouTube, TikTok, Instagram)',
                  'Multi-level user system integration',
                  'Advanced analytics tracking',
                  'Improved notification system',
                  'Web3 integration with opBNB',
                  'Better error handling',
                  'Mobile-first responsive design',
                  'Multi-language support',
                  'Keyboard shortcuts',
                  'Social sharing capabilities'
              ]
          };
          
          console.log('üêõ Debug mode enabled. Use cardViewerDebug object for debugging.');
          console.log('Available debug commands:', Object.keys(window.cardViewerDebug));
      }
 </script>
</body>
</html>
